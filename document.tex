\documentclass[nosortbib]{fefu}

\usepackage{subfiles}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{nicefrac}
\usepackage{hyperref}
\usepackage{minted}
\usepackage{multirow}
\usepackage{subcaption}
\usepackage{placeins}
\usepackage{upgreek}
\usepackage{scalerel}
\usepackage{bm}
\usepackage{refcount}
\usepackage{lastpage}
\usepackage[figure,table]{totalcount}
\usepackage{totcount}
\usepackage{filecontents}
\usepackage{pgfkeys}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning}

\DeclareTotalCounter{section}

\newtotcounter{citenum}
\AtEveryBibitem{\stepcounter{citenum}}

\setmainfont{CMU Serif}
\addbibresource{references.bib}
\graphicspath{{./images/}}

\newcommand{\pa}[1]{\left(#1\right)}
\newcommand{\code}[2][text]{\mintinline{#1}{#2}}
\newcommand{\paramrow}[4][-]{\code{#2} & \code{#3} & \code{#1} & #4\\}
\newcommand{\paramrowlistvalue}[4][]{\code{#2} & \code{#3} & \code{[#1]} & #4\\}
\newcommand{\niceref}[2]{\hyperref[#1]{#2 \ref{#1}}}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\introductiontitle}{Введение}
\DeclareMathOperator{\sech}{sech}

\author{Тыщенко Андрей Геннадьевич}
\setfaculty{1.2.2 -- Математическое моделирование, численные методы и комплексы программ}
\setsupervisor{Петров Павел Сергеевич}{д.ф.-м.н.}
\title{Численное моделирование распространения широкополосных акустических сигналов и шумов в мелком море с использованием модовых параболических уравнений}

\DeclareMathOperator*{\argmax}{arg\,max}

\newfontfamily{\catsfam}{Meows Nepil Illustration}[NFSSFamily=cats]
\DeclareMathAlphabet{\mathcats}{TU}{cats}{m}{n}

\fefuloadstyle{poi_phd}
\setdegree{кандидата физико-математических наук}

\newcounter{sectionscount}
\newcounter{allpagescount}
\newcounter{textpagescount}
\newcounter{figurescount}
\newcounter{tablescount}
\newcounter{citescount}
\newcounter{bibpagescount}
\newcommand{\handlecounts}{%
    \edef\bibpage{\getpagerefnumber{sec::bibliography}}%
    \edef\bibpages{\number\numexpr\getpagerefnumber{sec::bibliography_end}-\bibpage+1\relax}%
    \edef\textpages{\number\numexpr\bibpage-\getpagerefnumber{sec::introduction}\relax}%
    
    \iftotalsections%
    	\let\totalsectionsbuffer\totalsections%
    	\setcounter{sectionscount}{\totalsectionsbuffer}%
   	\else%
   		\setcounter{sectionscount}{0}%
   	\fi%

    \iftotalfigures%
        \let\totalfiguresbuffer\totalfigures%
        \setcounter{figurescount}{\totalfiguresbuffer}%
    \else%
        \setcounter{figurescount}{0}%
    \fi%

    \iftotaltables%
        \let\totaltablesbuffer\totaltables%
        \setcounter{tablescount}{\totaltablesbuffer}%
    \else%
        \setcounter{tablescount}{0}%
    \fi%

    \setcounter{allpagescount}{\getpagerefnumber{LastPage}}%
    \setcounter{textpagescount}{\textpages{}}%

    \setcounter{citescount}{\number\value{citenum@totc}}%
    \setcounter{bibpagescount}{\bibpages{}}%

    \begin{filecontents}{counters.tex}\end{filecontents}%
    \newwrite\file%
    \immediate\openout\file=counters.tex%
    
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/sectionscount}{\arabic{sectionscount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/allpagescount}{\arabic{allpagescount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/textpagescount}{\arabic{textpagescount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/figurescount}{\arabic{figurescount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/tablescount}{\arabic{tablescount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/citescount}{\arabic{citescount}}}%
    \immediate\write\file{\string\pgfkeyssetvalue{/counters/bibpagescount}{\arabic{bibpagescount}}}%

    \immediate\closeout\file%
}

\begin{document}
    \maketitle{thesis}
    \tableofcontents
    \subfile{subfiles/introduction.tex}
    \newpage
    \subfile{subfiles/subject.tex}
    \newpage
    \subfile{subfiles/math.tex}
    \newpage
    \subfile{subfiles/program.tex}
    \newpage
    \subfile{subfiles/experiments.tex}
    \newpage
    \subfile{subfiles/conclusion.tex}
    \newpage
    \label{sec::bibliography}
    \printbibliography
    \label{sec::bibliography_end}
    \newpage
    \subfile{subfiles/appendices.tex}
\end{document}
